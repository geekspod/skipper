<html>
<head>
    <title>VAOTQ</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src='https://unpkg.com/babel-standalone@6.26.0/babel.js'></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<img style="display: block; margin-left: auto; margin-right: auto; width: 45%; height: 45%;" src="{{ url_for('video_feed') }}" />
    <div id="root">
        <script type="text/babel">
                var socket = io.connect("http://localhost:5000/");
                function send_message(id) {
                    socket.emit('track_id', id);
                }
                const TrackTable = () => {
                    const [tracks, setTracks] = React.useState([]);
                    const [track_id, setTrackId] = React.useState(0);
                        socket.on("connect", function () {
                            console.log("connected");
                        });
                        socket.on("list", function (msg) {
                            console.log("Received message", msg);
                            setTracks(msg);
                            console.log(tracks);
                        });

                    return (
                        <div className="container mx-auto">
                            <button
                                className={"inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}
                                onClick={() => {
                                    recognition.start()
                                }}>Speak

                            </button>

                            <h1 className="my-4">People detected</h1>
                            <table className="min-w-full divide-y divide-gray-300 my-4">
                                <thead className="bg-gray-50">
                                <tr>
                                    <th className="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6">SR#</th>
                                    <th className="hidden px-3 py-3.5 text-left text-sm font-semibold text-gray-900 lg:table-cell">Tracking ID</th>
                                    <th className="hidden px-3 py-3.5 text-left text-sm font-semibold text-gray-900 sm:table-cell">Track</th>
                                </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-200 bg-white">
                                {
                                    tracks.map((value, key) => {
                                        console.log("value", value);
                                        return (
                                            <tr key={key}>
                                                <td className="w-full max-w-0 py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:w-auto sm:max-w-none sm:pl-6">{key}</td>
                                                <td className="w-full max-w-0 py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:w-auto sm:max-w-none sm:pl-6">{value}</td>
                                                <td>
                                                    <button
                                                        className={(value == track_id) ? "inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500":"inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}
                                                        onClick={() => {
                                                            send_message(value),
                                                                setTrackId(value)
                                                        }}>Track

                                                    </button>
                                                </td>
                                            </tr>
                                        )
                                    })
                                }
                                </tbody>
                            </table>
                        </div>
                    )
                }
                ReactDOM.render(<TrackTable />, document.querySelector('#root'));

                const speechRecognition = window.webkitSpeechRecognition;

                var recognition = new speechRecognition();

                recognition.continuous = true

                recognition.onstart = function() {

                    console.log("Voice Recognition is on")

                }

                recognition.onspeechend = function() {

                    console.log("No Activity")

                }

                recognition.onerror = function() {

                    console.error("Try Again")

                }

                recognition.onresult = function(event) {
                    const current = event.resultIndex;
                    const transcript = event.results[current][0].transcript;
                    socket.emit('command', transcript);
                    recognition.stop()
                }


        </script>
    </div>
</body>
</html>
